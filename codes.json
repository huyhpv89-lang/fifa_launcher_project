def validate_and_claim(code):
    codes = load_codes()
    if code not in codes:
        return False, "❌ Mã không tồn tại!"

    info = codes[code]

    # Kiểm tra khóa
    if info.get("locked", False):
        return False, "❌ Mã đã bị khoá bởi Admin."

    # Kiểm tra ngày hết hạn (nếu có)
    if "expire" in info:
        try:
            expire_date = datetime.datetime.strptime(info["expire"], "%Y-%m-%d").date()
            if datetime.datetime.now().date() > expire_date:
                return False, "❌ Mã đã hết hạn."
        except:
            return False, "❌ Định dạng ngày hết hạn không hợp lệ (YYYY-MM-DD)."

    return True, info
